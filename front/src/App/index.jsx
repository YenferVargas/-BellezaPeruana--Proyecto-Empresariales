import React, { Fragment, useEffect, useContext } from 'react';
import { MyContext } from './MyContext';
import { AllContext } from './MyContext';
import { Theme } from '../Components/Theme';

import { Main } from '../Components/Main';
import { Header } from '../Components/Header';
import { SideBar } from '../Components/SideBar';
import { Loading } from '../Components/Loading';

import { ModalSidebar } from '../Components/Modals/Sidebar/ModalSidebar';


const BgTheme = () => {
    const { ls, Icons } = useContext(AllContext);
    const icons = new Icons();
    return (
        <Fragment>
            <div className={`wipeInDown full-page-container ${ls.theme}`}>
            </div>
            <Effect />
            <Theme />
        </Fragment>
    )
}

function AppUI() {
    const { s, ls, f, hp, useNavigate } = useContext(AllContext);
    const navigate = useNavigate();

    const abierto = ([false, true].includes(s?.mainContainer?.sideBar) ? s?.mainContainer?.sideBar : true) || !!s?.hovers?.sidebar;

    useEffect(() => {
        f.validateRunMode();
    }, [s?.exinit]);

    useEffect(() => {
        hp.cambiarThema(ls?.theme)
    }, [ls?.theme]);

    const md = s.sizes?.md;

    const validarSize = () => {
        const width = window.innerWidth;
        if (width <= 768) {
            f.upgradeLvl1('sizes', 'md', true);
        } else {
            f.upgradeLvl1('sizes', 'md', false);
            f.upgradeLvl2('modals', 'sidebar', 'show', false);
        }
    }

    useEffect(() => {
        validarSize();
        window.addEventListener('resize', validarSize);
    }, []);

    useEffect(() => {
        const url = s?.stateNavigation?.location;
        if (!url) return;
        navigate(url);
    }, [s?.stateNavigation?.location, s?.stateNavigation?.reload]);


    if (!s.loadings?.init ) {
        return (
            <div 
                className="flex w-full flex-wrap">
                <BgTheme />
                <ModalSidebar />
                <nav className={`${md && 'hidden'} flex ${abierto ? 'short-div-abierto' : 'short-div-cerrado'}`}>
                    <SideBar />
                </nav>

                <div 
                    className={`flex flex-wrap ${abierto ? 'large-div-abierto' : 'large-div-cerrado'} justify-start items-start content-start`}
                    id="main-container">
                    <header className='w-full flex h-[60px]'>
                        <Header abierto={abierto}/>
                    </header>
                    <Main />
                </div>
            </div>
        );
    } else {
        return (
            <div className="flex w-full flex-wrap">
                <BgTheme />
                <div className="flex flex-wrap w-full justify-center items-center content-center">
                    <Loading />
                </div>
            </div>
        )
    }
}

const Effect = () => {
    const { ls } = useContext(AllContext);
    // <svg id="wave" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1200 120" preserveAspectRatio="none">
    return (
        <div className={`light-effect ${ls.theme}`}>
            <svg id="wave" className="wave-0" preserveAspectRatio="none" viewBox="0 0 1440 300" version="1.1" xmlns="http://www.w3.org/2000/svg"><defs><linearGradient id="sw-gradient-0" x1="0" x2="0" y1="1" y2="0"><stop stopColor="var(--stop-1)" offset="0%"></stop><stop stopColor="var(--stop-2)" offset="100%"></stop></linearGradient></defs><path className="wave-1" fill="url(#sw-gradient-0)" d="M0,0L21.8,5C43.6,10,87,20,131,45C174.5,70,218,110,262,125C305.5,140,349,130,393,135C436.4,140,480,160,524,145C567.3,130,611,80,655,65C698.2,50,742,70,785,100C829.1,130,873,170,916,175C960,180,1004,150,1047,115C1090.9,80,1135,40,1178,25C1221.8,10,1265,20,1309,65C1352.7,110,1396,190,1440,210C1483.6,230,1527,190,1571,150C1614.5,110,1658,70,1702,70C1745.5,70,1789,110,1833,115C1876.4,120,1920,90,1964,90C2007.3,90,2051,120,2095,145C2138.2,170,2182,190,2225,185C2269.1,180,2313,150,2356,150C2400,150,2444,180,2487,175C2530.9,170,2575,130,2618,105C2661.8,80,2705,70,2749,65C2792.7,60,2836,60,2880,70C2923.6,80,2967,100,3011,100C3054.5,100,3098,80,3120,70L3141.8,60L3141.8,300L3120,300C3098.2,300,3055,300,3011,300C2967.3,300,2924,300,2880,300C2836.4,300,2793,300,2749,300C2705.5,300,2662,300,2618,300C2574.5,300,2531,300,2487,300C2443.6,300,2400,300,2356,300C2312.7,300,2269,300,2225,300C2181.8,300,2138,300,2095,300C2050.9,300,2007,300,1964,300C1920,300,1876,300,1833,300C1789.1,300,1745,300,1702,300C1658.2,300,1615,300,1571,300C1527.3,300,1484,300,1440,300C1396.4,300,1353,300,1309,300C1265.5,300,1222,300,1178,300C1134.5,300,1091,300,1047,300C1003.6,300,960,300,916,300C872.7,300,829,300,785,300C741.8,300,698,300,655,300C610.9,300,567,300,524,300C480,300,436,300,393,300C349.1,300,305,300,262,300C218.2,300,175,300,131,300C87.3,300,44,300,22,300L0,300Z"></path><defs><linearGradient id="sw-gradient-1" x1="0" x2="0" y1="1" y2="0"><stop stopColor="var(--stop-1)" offset="0%"></stop><stop stopColor="var(--stop-2)" offset="100%"></stop></linearGradient></defs><path className="wave-2" fill="url(#sw-gradient-1)" d="M0,240L21.8,210C43.6,180,87,120,131,115C174.5,110,218,160,262,170C305.5,180,349,150,393,140C436.4,130,480,140,524,165C567.3,190,611,230,655,230C698.2,230,742,190,785,160C829.1,130,873,110,916,110C960,110,1004,130,1047,120C1090.9,110,1135,70,1178,45C1221.8,20,1265,10,1309,40C1352.7,70,1396,140,1440,155C1483.6,170,1527,130,1571,95C1614.5,60,1658,30,1702,35C1745.5,40,1789,80,1833,120C1876.4,160,1920,200,1964,185C2007.3,170,2051,100,2095,90C2138.2,80,2182,130,2225,145C2269.1,160,2313,140,2356,125C2400,110,2444,100,2487,90C2530.9,80,2575,70,2618,80C2661.8,90,2705,120,2749,150C2792.7,180,2836,210,2880,210C2923.6,210,2967,180,3011,160C3054.5,140,3098,130,3120,125L3141.8,120L3141.8,300L3120,300C3098.2,300,3055,300,3011,300C2967.3,300,2924,300,2880,300C2836.4,300,2793,300,2749,300C2705.5,300,2662,300,2618,300C2574.5,300,2531,300,2487,300C2443.6,300,2400,300,2356,300C2312.7,300,2269,300,2225,300C2181.8,300,2138,300,2095,300C2050.9,300,2007,300,1964,300C1920,300,1876,300,1833,300C1789.1,300,1745,300,1702,300C1658.2,300,1615,300,1571,300C1527.3,300,1484,300,1440,300C1396.4,300,1353,300,1309,300C1265.5,300,1222,300,1178,300C1134.5,300,1091,300,1047,300C1003.6,300,960,300,916,300C872.7,300,829,300,785,300C741.8,300,698,300,655,300C610.9,300,567,300,524,300C480,300,436,300,393,300C349.1,300,305,300,262,300C218.2,300,175,300,131,300C87.3,300,44,300,22,300L0,300Z"></path><defs><linearGradient id="sw-gradient-2" x1="0" x2="0" y1="1" y2="0"><stop stopColor="var(--stop-1)" offset="0%"></stop><stop stopColor="var(--stop-2)" offset="100%"></stop></linearGradient></defs><path className="wave-3" fill="url(#sw-gradient-2)" d="M0,30L21.8,55C43.6,80,87,130,131,130C174.5,130,218,80,262,65C305.5,50,349,70,393,70C436.4,70,480,50,524,40C567.3,30,611,30,655,35C698.2,40,742,50,785,55C829.1,60,873,60,916,85C960,110,1004,160,1047,150C1090.9,140,1135,70,1178,60C1221.8,50,1265,100,1309,120C1352.7,140,1396,130,1440,115C1483.6,100,1527,80,1571,85C1614.5,90,1658,120,1702,120C1745.5,120,1789,90,1833,110C1876.4,130,1920,200,1964,210C2007.3,220,2051,170,2095,145C2138.2,120,2182,120,2225,115C2269.1,110,2313,100,2356,100C2400,100,2444,110,2487,95C2530.9,80,2575,40,2618,60C2661.8,80,2705,160,2749,165C2792.7,170,2836,100,2880,60C2923.6,20,2967,10,3011,45C3054.5,80,3098,160,3120,200L3141.8,240L3141.8,300L3120,300C3098.2,300,3055,300,3011,300C2967.3,300,2924,300,2880,300C2836.4,300,2793,300,2749,300C2705.5,300,2662,300,2618,300C2574.5,300,2531,300,2487,300C2443.6,300,2400,300,2356,300C2312.7,300,2269,300,2225,300C2181.8,300,2138,300,2095,300C2050.9,300,2007,300,1964,300C1920,300,1876,300,1833,300C1789.1,300,1745,300,1702,300C1658.2,300,1615,300,1571,300C1527.3,300,1484,300,1440,300C1396.4,300,1353,300,1309,300C1265.5,300,1222,300,1178,300C1134.5,300,1091,300,1047,300C1003.6,300,960,300,916,300C872.7,300,829,300,785,300C741.8,300,698,300,655,300C610.9,300,567,300,524,300C480,300,436,300,393,300C349.1,300,305,300,262,300C218.2,300,175,300,131,300C87.3,300,44,300,22,300L0,300Z"></path><defs><linearGradient id="sw-gradient-3" x1="0" x2="0" y1="1" y2="0"><stop stopColor="var(--stop-1)" offset="0%"></stop><stop stopColor="var(--stop-2)" offset="100%"></stop></linearGradient></defs><path className="wave-4" fill="url(#sw-gradient-3)" d="M0,240L21.8,200C43.6,160,87,80,131,55C174.5,30,218,60,262,75C305.5,90,349,90,393,75C436.4,60,480,30,524,50C567.3,70,611,140,655,140C698.2,140,742,70,785,45C829.1,20,873,40,916,75C960,110,1004,160,1047,175C1090.9,190,1135,170,1178,135C1221.8,100,1265,50,1309,50C1352.7,50,1396,100,1440,145C1483.6,190,1527,230,1571,235C1614.5,240,1658,210,1702,200C1745.5,190,1789,200,1833,190C1876.4,180,1920,150,1964,160C2007.3,170,2051,220,2095,240C2138.2,260,2182,250,2225,235C2269.1,220,2313,200,2356,170C2400,140,2444,100,2487,75C2530.9,50,2575,40,2618,75C2661.8,110,2705,190,2749,210C2792.7,230,2836,190,2880,160C2923.6,130,2967,110,3011,110C3054.5,110,3098,130,3120,140L3141.8,150L3141.8,300L3120,300C3098.2,300,3055,300,3011,300C2967.3,300,2924,300,2880,300C2836.4,300,2793,300,2749,300C2705.5,300,2662,300,2618,300C2574.5,300,2531,300,2487,300C2443.6,300,2400,300,2356,300C2312.7,300,2269,300,2225,300C2181.8,300,2138,300,2095,300C2050.9,300,2007,300,1964,300C1920,300,1876,300,1833,300C1789.1,300,1745,300,1702,300C1658.2,300,1615,300,1571,300C1527.3,300,1484,300,1440,300C1396.4,300,1353,300,1309,300C1265.5,300,1222,300,1178,300C1134.5,300,1091,300,1047,300C1003.6,300,960,300,916,300C872.7,300,829,300,785,300C741.8,300,698,300,655,300C610.9,300,567,300,524,300C480,300,436,300,393,300C349.1,300,305,300,262,300C218.2,300,175,300,131,300C87.3,300,44,300,22,300L0,300Z"></path></svg>
        </div>
    )
}

function App(props) {
    return (
        <MyContext>
            <AppUI />
        </MyContext>
    );
}

export default App;
